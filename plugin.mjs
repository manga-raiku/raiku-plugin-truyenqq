var It=Object.defineProperty;var _t=(H,_,d)=>_ in H?It(H,_,{enumerable:!0,configurable:!0,writable:!0,value:d}):H[_]=d;var N=(H,_,d)=>(_t(H,typeof _!="symbol"?_+"":_,d),d);(function(){"use strict";const H=[];for(let t=0;t<256;++t)H.push((t+256).toString(16).slice(1));typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);function _(t){try{const{pathname:e,search:n}=new URL(t);return`${e}${n}`}catch(e){return t}}function d(t,e){const n=_(t.attr("href")),a=t.text().trim();return{path:n,name:e?e(a):a}}function Q(t){const[e,n,a]=t.split("/");return new Date(`00:00 ${n}/${e}/${a}`).getTime()}function L(t){t=t.trim().toLowerCase().replace(".","");const e=parseFloat(t);if(Number.isNaN(e))return null;switch(t[t.length-1]){case"k":return e*1e3;case"m":return e*1e6;case"g":return e*1e9;default:return e}}function T(t,e){return t=t.trim().toLowerCase(),t.endsWith("giây trước")?e-parseInt(t)*1e3:t.endsWith("phút trước")?e-parseInt(t)*1e3*60:t.endsWith("giờ trước")?e-parseInt(t)*1e3*60*60:t.endsWith("ngày trước")?e-parseInt(t)*1e3*60*60*24:t.endsWith("tháng trước")?e-parseInt(t)*1e3*60*60*24*30:t.endsWith("năm trước")?e-parseInt(t)*1e3*60*60*24*365:new Date(t.replace(/^(\d{1,2}):(\d{1,2}) (\d{1,2})\/(\d{1,2})(\/\d{2,4})?$/,(n,a,s,o,r,c)=>{var i;return`${a}:${s}:00 ${r}/${o}/${(i=c==null?void 0:c.slice(1))!=null?i:new Date(e).getFullYear()}`})).getTime()||new Date(t.replace(/^(\d{1,2})\/(\d{1,2})\/(\d{1,})$/,"$2/$1/$3")).getTime()}const V=/^Chương|Chapter|Chap\.?\s+/i;function U(t){return t.replace(V,"").trim()}function q(t){const{pathname:e}=new URL(t,"http://localhost");return!e||e==="/"||e==="/index"||e==="/index.html"}function X(t){return Object.assign(self,{__DEFINE_API__:t}),t}function Y(t){return Object.assign(self,{__DEFINE_PACKAGE__:t}),t}function D(t,e){return`https://proxy.mangaraiku.eu.org/?url=${encodeURIComponent(t.slice(t.indexOf(".")+1).split("/",1)[0]==="googleusercontent.com"?t:`https://images2-focus-opensocial.googleusercontent.com/gadgets/proxy?container=focus&gadget=a&no_expand=1&resize_h=0&rewriteMime=image%2F*&url=${encodeURIComponent(t)}`)}&headers=${encodeURIComponent(JSON.stringify(e))}`}const g="https://truyenqqvn.com",P={"mangaqq.net":"i200.truyenvua.com","cdnqq.xyz":"i200.truyenvua.com","mangaqq.com":"i216.truyenvua.com","photruyen.com":"i109.truyenvua.com","tintruyen.com":"i109.truyenvua.com","trangshop.net":"i109.truyenvua.com","tintruyen.net":"i138.truyenvua.com","i125.tintruyen.net":"i125.truyenvua.com","qqtaku.com":"i125.truyenvua.com"},R={referer:g},K=[{name:"Server 1",has:()=>!0,parse:({pages:t})=>t.map(e=>D(e.src,R))},{name:"Server 2",has:({pages:t})=>t[0].original!==null,parse:({pages:t})=>t.map(e=>D(e.original,R))},{name:"Server 4",has:({pages:t})=>{var e;for(const n in P)if((e=t[0].cdn)!=null&&e.includes(n))return!0;return!1},parse:({pages:t})=>t.map(e=>{var n;for(const a in P)if((n=e.original)!=null&&n.includes(a))return D(e.original.replace(a,P[a]),R);return D(e.original,R)})},{name:"Server 5",has:({pages:t})=>t[0].cdn!==null,parse:({pages:t})=>t.map(e=>D(e.cdn,R))}],z=[{value:"ngay",match:"/top-ngay.html",name:{"vi-VN":"Ngày","en-US":"Date"}},{value:"tuan",match:"/top-tuan.html",name:{"vi-VN":"Tuần","en-US":"Week"}},{value:"thang",match:"/top-thang.html",name:{"vi-VN":"Tháng","en-US":"Month"}}],B="truyenqqq",Z="Truyện QQ",tt="0.0.14",et="Plugin nguồn của Truyện QQ.",nt="Tachibana Shin <tachibshin@duck.com>",at="https://github.com/manga-raiku/raiku-plugin-truyenqq",rt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAACf1BMVEUjHyAjHiEiISAkHyEkICEiHh4jHiAtKihXNROFTiAnICQAAAA6KyYAADpDMiUnIiJsQiIjHyAjHyAjHyAjHyAjHyAjHyAkHyEkICEjHyAjHyAkICEmISEkHyArJyg9OTorJygvLCw7NzgmIiMjICEqJisiHh82MjOura3m5eWwr68zLzBDQEHAv7/l5OWYlpYoJCUjHyAkICEjHyAiHh+Jh4jQz8/x8PBxbm8gHB2XlZbf399hXl8gHB0jHyEmIiO4t7fU09SLiosdGx25t7iMioseGhwnIyTJycqBcGOglY7DwsKMiosfGxwlISKzsbLv8PCsmYvCiFe9h1ujlYr///+DgYEfGxwiHh9XVFTZ2dn+/v76+vvq7O7Cu6eejVy7uro6NzgiHh8jHyAhHR5EQEG/vb78/Px2XBUsKCUjHyAkICEpJSYdGRpAPD3f398kICEjHyAlISKDgIGRj4+UkpPt7e1qYEdOS0shHR4kHyEkICEhHR5gXV7f3t7y8O/19fX29vjKwam7tak9OjsiHh8lISEkHyAkICE+OjpeVE5YUlFVUlNVU1NVUE83MjIjHx8jICErJCFrQR9ELR4gGxsdGRseGhseGhxGLx5sQSBUNyErJSdeOyFoQCFGLyIFEyI/LCFpQCFgPCFiPiIjHyAiHh+ysbHm5uarqqqRj5BZVlcgHR+0s7S8u7tJRke5uLh9e3tsPxtpPhzHyMl7eXr////8/PzGwbPd3Nf9/f2qkk6QcBb09fe/qWrHlAakegX+/v79/v/SyrPMnBa3ig04Lh0hHh/x8fHAo1TKlwhzWRbz7+z07+qyjja/qXRhVU5aTUVaUEx8SB5/Sh+kvHkiAAAApXRSTlMAAAAAAAAAAAAAAAAAAAAAADWs7/7spC4yz8UoCaL78/n78vqSA9/89/jr9Pz79eL1zRsz7ff++dz+/vDW2yfu/vvU/v3H1+7y1/v9xdfu+/Tt8vT7+cTY7vDz/v36+/zT3t3u/vLw/vns3e78/fX4+jDq8ff7/PjO1SQWv/P2+PLy+d7crQ1H1ff+9Onp9fXMOD7l2X5wcITd7EMMe5Q7AkSWew2abqMxAAAAAWJLR0RVkwS4MwAAAAd0SU1FB+cKAg8rCSPcU0AAAAEUSURBVBjTY2BgFBQSXgoCIqJi4kzMDAwSksuWLQMJAEkpaRYGGdllcvIKQJFlikrKy1RUGaTV1DU0tbSXLdPR1dM3MDRiMDYxNVtubmG5zGrFSmsbWzsGY3uHVasdnZzXrF233sXVDSjgvmHDRg/PTZu9tmz19vEFCvj5b9seEBgUHLJjZ2hYOFAgIjIqeldMbNzuPfEJiUlAgeSU1LT0XXv37T+QkbksCyiQnZObl3/w0OEjR48dLwAKFBYVl5SWHdx14uSp0+UVlVUM1TW1dWfO1jc0Np0739zS2sbA2t7R2XWhu6e37+Kl/gkT2RjYOSZNvjxl6rTpM2ZemTWbk4uBm2fO3Hnzefn4FyxctHiJADcAQx5tLT0vWccAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjMtMTAtMDJUMTU6NDM6MDkrMDA6MDCZdQqgAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIzLTEwLTAyVDE1OjQzOjA5KzAwOjAw6CiyHAAAAABJRU5ErkJggg==",S=B;Y({id:B,name:Z,favicon:rt,version:tt,description:et,author:nt,homepage:at,isNSFW:!1,language:"vi",updatedAt:1698029024597});function E(t){t=t.replace(/\.html$/i,"");const e=t.indexOf("/truyen-tranh/")+14;if(e===13)throw new Error("Invalid url "+t);t=t.slice(e,t.indexOf("?",e)>>>0).replace(/\.html$/,"");const n=t.match(/(.+?)-chap-(\d+)$/)||t.match(/(.+)$/);if(n){const[,a,s]=n;return s?{name:"comic chap",params:{sourceId:S,comic:a,chap:s}}:{name:"comic",params:{sourceId:S,comic:a}}}throw new Error("Invalid url "+t)}function b(t,e,n){var h;const a=E(e.find("a").attr("href")),s=e.find("img").attr("src"),o=e.find(".book_name").text().trim(),r=e.find(".more-info .info"),c=d(e.find(".last_chapter > a"),u=>U(u).replace("Đọc Tiếp","").trim()),i=E(c.path),y=[{route:i,name:c.name,id:(h=i.params.chap)!=null?h:i.params.comic,updated_at:T(e.find(".time-ago").text().trim(),n),views:null}],k=e.find(".type-label").text().trim(),x=r.length===0?null:r.eq(0).text().replace("Tình trạng:","").trim(),v=r.length===0?null:L(r.eq(2).text().trim().replace("Lượt theo dõi:","").replace(/,/g,"")),w=e.find(".list-tags").find("p").toArray().map(u=>t(u).text()),p=e.find(".excerpt").text().trim(),l=r.length===0?null:L(r.eq(1).text().trim().replace("Lượt xem:","").trim().replace(/,/g,""));return{route:a,image:s,name:o,othername:null,author:null,last_chapters:y,label:k,status:x,views:l,likes:v,comments:null,tags:w,description:p}}function st(t,e){const n=parseDom(t),a=n(".hero .is-child").toArray().map(r=>{var p;const c=n(r),i=E(c.find("a").attr("href")),y=c.find("img").attr("src").replace("290x191","583x386"),k=c.find("h3").text(),x=c.find("h5").text().replace("Thể loại: ","").split(",").map(l=>l.trim())||[],v=c.find(".excerpt").text(),w=[{route:i,name:U(c.find(".chapter").text()),id:(p=i.params.chap)!=null?p:i.params.comic,updated_at:null,views:null}];return{route:{name:"comic",params:{sourceId:i.params.sourceId,comic:i.params.comic}},last_chapters:w,image:y,name:k,othername:"",status:"",author:"",views:null,comments:null,likes:null,label:null,tags:x,description:v}}),s=n("#div_suggest li").toArray().map(r=>b(n,n(r),e)),o=n("#main_homepage li").toArray().map(r=>b(n,n(r),e));return{sliders:a,hot:s,last_update:o}}function G(t){t=t.replace(/\.html$/i,"");const e=t.indexOf("/the-loai/")+10,n=t.slice(e,t.indexOf("?",e)>>>0).replace(/\/$/,"").replace(/\/$/,"_");return{name:"genre",params:{sourceId:S,type:n},query:Object.fromEntries(new URL(t,"http://localhost").searchParams.entries())}}function O(t,e){var x,v,w;const n=parseDom(t),a=n(".homepage_tags h1").text().trim(),s=n(".tags_detail").text().trim(),o=n(".story-list-bl01 tr").toArray().map(p=>{const l=n(p),h=l.find("th").text(),u=l.find("select option").toArray().map(m=>{const A=n(m),$=G(A.attr("value")),C=A.text();return{route:$,name:C}});if(h==="Sắp xếp"){let m="";const A=u.map($=>{const[C,f]=Object.entries($.route.query).at(-1);m=C;const I=$.name;return{value:f,name:I}});return{type:h,key:m,items:A}}if(u.length===0){let m="";const A=l.find(".choose a").toArray().map($=>{const C=n($),[f,I]=[...new URL(C.attr("href"),"http://localhost").searchParams.entries()].at(-1);m=f;const j=C.text();return{value:I,name:j}});return{type:h,key:m,items:A}}return{type:h,select:u}}),r=n("#main_homepage .list_grid li").toArray().map(p=>b(n,n(p),e)),c=parseInt(n(".page_redirect .active").text()),i=Number.isNaN(c)?1:c,y=parseInt((w=(v=(x=n(".page_redirect > *").last().attr("href"))==null?void 0:x.match(/\/trang-(\d+)/))==null?void 0:v[1])!=null?w:i+""),k=Number.isNaN(y)?1:y;return{name:a,description:s,filters:o,items:r,curPage:i,maxPage:k}}async function F(t,e,n){const{data:a,url:s}=await get({url:`${g}/${t.replace(".html","")}/trang-${e}.html?${new URLSearchParams(n)}`});if(q(s))throw new Error("not_found");return O(a,Date.now())}async function ot(){const[t,e]=await Promise.all([get({url:g}).then(n=>st(n.data,Date.now())),F("top-ngay",1,{})]);return{sliders:e.items.slice(0,7),hot:e.items.slice(7),last_update:t.last_update}}async function ct(t,e,n){const a=new URL(t,"http://localhost");a.searchParams.delete("page");for(const o in n){const r=n[o];Array.isArray(r)?r.forEach(c=>{a.searchParams.append(o,c)}):a.searchParams.set(o,n[o]+"")}const{data:s}=await get({url:`${g}/${a.pathname}/trang-${e}.html?${a.searchParams+""}`});return O(s,Date.now())}function M(t,e){const n=+t.find(".reply-comment").attr("onclick").match(/addReply\((\d+)\)/)[1]+"",a={avatar:t.find(".avartar-comment img").attr("data-src"),name:t.find(".outline-content-comment strong").text(),level:null,chapter:""},s=t.find(".content-comment").html().trim(),o=parseInt(t.find(".total-like-comment").text()),r=T(t.find(".time").text(),e),c=t.find(".text-list-reply").length===0?0:parseInt(t.find(".text-list-reply").text().trim());return{id:n,author:a,content:s,like:o,dislike:0,created_at:r,replies:c,chapter_name:""}}function it(t,e){var r,c;const n=parseDom(t),a=n(".info-comment").toArray().map(i=>M(n(i),e)),s=parseInt(n(".comment-count").text()),o=parseInt(((c=(r=n("#comment_list .page_redirect > p").last().attr("onclick"))==null?void 0:r.match(/(\d+)/))==null?void 0:c[1])||"0");return{comments:a,comments_count:s,comments_pages:o}}async function mt(t,e=0,n=1,a,s){const{data:o}=await post({url:`${g}/frontend/comment/list`,data:{book_id:t,parent_id:e,page:n,episode_id:a,team_id:s}});return it(o,Date.now())}function W(t){const e=parseDom(t);return e("a").toArray().map(n=>{const a=e(n),s=a.find(".time-chap"),{name:o,path:r}=d(a.find("a"),U),c=E(r);return{route:c,id:c.params.chap,name:o,updated_at:Q(s.text()),views:null}})}async function ut(t){const{data:e}=await post({url:`${g}/frontend/manga/list`,data:{id:t,order:1}});return await W(e)}function pt(t){const e=parseDom(t);return e("li > a").toArray().map(n=>{const a=e(n),s=E(a.attr("href")),o=a.find("img").attr("src"),r=a.find(".name").text(),c=a.find(".name_other").text(),i=U(a.find(".search_info p:eq(2)").text());return{route:s,image:o,name:r,othername:c,last_chapter:i,tags:[]}})}async function lt(t){const{data:e}=await post({url:`${g}/frontend/search/search`,data:{type:"0",search:t}});return pt(e)}async function ht(t,e){const{data:n}=await get({url:`${g}/tim-kiem/trang-${e}.html?q=${encodeURIComponent(t)}`});return O(n,Date.now())}function dt(t){t=t.replace(/\.html$/i,"");const e=t.indexOf("/tac-gia/")+9,n=t.slice(e,t.indexOf("?",e)>>>0).replace(/\/$/,"").replace(/\/$/,"_");return{name:"author",params:{sourceId:S,type:n},query:Object.fromEntries(new URL(t,"http://localhost").searchParams.entries())}}function gt(t,e){var $,C;const n=parseDom(t),a=n(".book_other h1").text().trim(),s=n(".other-name").text(),o=parseInt(n("#book_id").attr("value"))+"",r=T(n(".time-chap").eq(0).text().trim(),e),c=n(".book_avatar img").attr("src"),i=n(".author a").toArray().map(f=>{const{name:I,path:j}=d(n(f));return{name:I,route:dt(j)}}),y=n(".status p:not(.name)").text().trim(),k=n(".list01 a").toArray().map(f=>{const{name:I,path:j}=d(n(f));return{name:I,route:G(j)}}),x=L(n(".status").next().next().next().find("p:not(.name)").text().replace(/,/g,"")),v={cur:0,max:0,count:0},w=parseInt(n(".status").next().next().find("p:not(.name)").text().replace(/,/g,"")),p=parseInt(n(".status").next().find("p:not(.name)").text().replace(/,/g,"")),l=n(".detail-content").text().trim(),h=n(".works-chapter-item").toArray().map(f=>{const I=n(f),j=I.find(".time-chap"),{name:vt,path:wt}=d(I.find("a"),U),J=E(wt);return{route:J,id:J.params.chap,name:vt,updated_at:Q(j.text()),views:null}}),u=n(".info-comment").toArray().map(f=>M(n(f),e)),m=parseInt(n(".comment-count").text()),A=parseInt(((C=($=n("#comment_list .page_redirect > p").last().attr("onclick"))==null?void 0:$.match(/(\d+)/))==null?void 0:C[1])||"0");return{name:a,othername:s,manga_id:o,updated_at:r,image:c,author:i,status:y,genres:k,views:x,rate:v,follows:w,likes:p,description:l,chapters:h,comments:u,comments_count:m,comments_pages:A}}async function At(t){const{data:e,url:n}=await get({url:`${g}/truyen-tranh/${t}.html`});if(q(n))throw new Error("not_found");return gt(e,Date.now())}function ft(t,e,n=!1){var l,h;const a=parseDom(t),s=a("h1 > a").text(),o=parseInt(a("#book_id").attr("value"))+"",r=parseInt(a("#episode_name").attr("value"))+"",c=new Date(a(".detail-title").next("time").attr("datetime")).getTime(),i=a('meta[property="og:image"]').attr("content"),y=E(a("#path > ol > li:nth-child(2) > a").attr("href")),k=a(".page-chapter img").toArray().map(u=>{const m=a(u);return{src:m.attr("src"),original:m.attr("data-original"),cdn:m.attr("data-cdn")}}),x=a(".info-comment").toArray().map(u=>M(a(u),e)),v=parseInt(a(".comment-count").text()),w=parseInt(((h=(l=a("#comment_list .page_redirect > p").last().attr("onclick"))==null?void 0:l.match(/(\d+)/))==null?void 0:h[1])||"0"),p=a(".chapter_list option").toArray().map(u=>{const m=a(u),A=E(m.attr("value"));return{route:A,id:A.params.chap,name:U(m.text().trim()),updated_at:null,views:null}});return{name:s,manga_id:o,ep_id:r,updated_at:c,image:i,path_manga:y,pages:k,comments:x,comments_count:v,comments_pages:w,chapters:n?void 0:p}}async function yt(t,e,n){const{data:a,url:s}=await get({url:`${g}/truyen-tranh/${t}-chap-${e}.html`});if(q(s))throw new Error("not_found");const o=await ft(a,Date.now(),n);if(!n&&!o.chapters){const{data:r}=await post({url:`${g}/frontend/manga/list`,data:{id:o.manga_id,order:1}});o.chapters=await W(r)}return o}class xt{constructor(){N(this,"Rankings",z);N(this,"Servers",K)}async setup(){return{isSupport:!0}}async index(){return ot()}async getComic(e){return At(e)}async getComicChapter(e,n,a){return yt(e,n,a)}async getComicComments(e,n,a=-1,s=0,o,r){return mt(e,s,o,a,r)}async getListChapters(e){return ut(e)}async searchQuickly(e,n){return lt(e)}async search(e,n){return ht(e,n)}async getRanking(e,n,a){e=e.toLowerCase();const s=z.find(o=>o.value.toLowerCase()===e);if(!s)throw new Error("not_found");return F(s.match,n,a)}async getCategory(e,n,a){return ct(e,n,a)}}X(xt)})();
