var It=Object.defineProperty;var _t=(j,_,d)=>_ in j?It(j,_,{enumerable:!0,configurable:!0,writable:!0,value:d}):j[_]=d;var S=(j,_,d)=>(_t(j,typeof _!="symbol"?_+"":_,d),d);(function(){"use strict";const j=[];for(let t=0;t<256;++t)j.push((t+256).toString(16).slice(1));typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);function _(t){try{const{pathname:e,search:n}=new URL(t);return`${e}${n}`}catch(e){return t}}function d(t,e){const n=_(t.attr("href")),a=t.text().trim();return{path:n,name:e?e(a):a}}function Q(t){const[e,n,a]=t.split("/");return new Date(`00:00 ${n}/${e}/${a}`).getTime()}function T(t){t=t.trim().toLowerCase().replace(".","");const e=parseFloat(t);if(Number.isNaN(e))return null;switch(t[t.length-1]){case"k":return e*1e3;case"m":return e*1e6;case"g":return e*1e9;default:return e}}function q(t,e){return t=t.trim().toLowerCase(),t.endsWith("giây trước")?e-parseInt(t)*1e3:t.endsWith("phút trước")?e-parseInt(t)*1e3*60:t.endsWith("giờ trước")?e-parseInt(t)*1e3*60*60:t.endsWith("ngày trước")?e-parseInt(t)*1e3*60*60*24:t.endsWith("tháng trước")?e-parseInt(t)*1e3*60*60*24*30:t.endsWith("năm trước")?e-parseInt(t)*1e3*60*60*24*365:new Date(t.replace(/^(\d{1,2}):(\d{1,2}) (\d{1,2})\/(\d{1,2})(\/\d{2,4})?$/,(n,a,o,s,r,c)=>{var i;return a+":"+o+":00 "+r+"/"+s+"/"+((i=c==null?void 0:c.slice(1))!=null?i:new Date(e).getFullYear())})).getTime()||new Date(t.replace(/^(\d{1,2})\/(\d{1,2})\/(\d{1,})$/,"$2/$1/$3")).getTime()}const V=/^Chương|Chapter|Chap\.?\s+/i;function R(t){return t.replace(V,"").trim()}function P(t){const{pathname:e}=new URL(t,"http://localhost");return!e||e==="/"||e==="/index"||e==="/index.html"}function X(t){return Object.assign(self,{__DEFINE_API__:t}),t}function Y(t){return Object.assign(self,{__DEFINE_PACKAGE__:t}),t}function U(t,e){return`https://proxy.mangaraiku.eu.org/?url=${encodeURIComponent(t.slice(t.indexOf(".")+1).split("/",1)[0]==="googleusercontent.com"?t:`https://images2-focus-opensocial.googleusercontent.com/gadgets/proxy?container=focus&gadget=a&no_expand=1&resize_h=0&rewriteMime=image%2F*&url=${encodeURIComponent(t)}`)}&headers=${encodeURIComponent(JSON.stringify(e))}`}const g="https://truyenqqvn.com",b={"mangaqq.net":"i200.truyenvua.com","cdnqq.xyz":"i200.truyenvua.com","mangaqq.com":"i216.truyenvua.com","photruyen.com":"i109.truyenvua.com","tintruyen.com":"i109.truyenvua.com","trangshop.net":"i109.truyenvua.com","tintruyen.net":"i138.truyenvua.com","i125.tintruyen.net":"i125.truyenvua.com","qqtaku.com":"i125.truyenvua.com"},D={referer:g},K=[{name:"Server 1",has:()=>!0,parse:t=>U(t.src,D)},{name:"Server 2",has:t=>t.original!==null,parse:t=>U(t.original,D)},{name:"Server 4",has:t=>{var e;for(const n in b)if((e=t.cdn)!=null&&e.includes(n))return!0;return!1},parse:t=>{var e;for(const n in b)if((e=t.original)!=null&&e.includes(n))return U(t.original.replace(n,b[n]),D);return U(t.original,D)}},{name:"Server 5",has:t=>t.cdn!==null,parse:t=>U(t.cdn,D)}],z=[{value:"ngay",match:"/top-ngay.html",name:{"vi-VN":"Ngày","en-US":"Date"}},{value:"tuan",match:"/top-tuan.html",name:{"vi-VN":"Tuần","en-US":"Week"}},{value:"thang",match:"/top-thang.html",name:{"vi-VN":"Tháng","en-US":"Month"}}],B="truyenqqq",Z="Truyện QQ",tt="0.0.12",et="Plugin nguồn của Truyện QQ.",nt="Tachibana Shin <tachibshin@duck.com>",at="https://github.com/manga-raiku/raiku-plugin-truyenqq",rt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAACf1BMVEUjHyAjHiEiISAkHyEkICEiHh4jHiAtKihXNROFTiAnICQAAAA6KyYAADpDMiUnIiJsQiIjHyAjHyAjHyAjHyAjHyAjHyAkHyEkICEjHyAjHyAkICEmISEkHyArJyg9OTorJygvLCw7NzgmIiMjICEqJisiHh82MjOura3m5eWwr68zLzBDQEHAv7/l5OWYlpYoJCUjHyAkICEjHyAiHh+Jh4jQz8/x8PBxbm8gHB2XlZbf399hXl8gHB0jHyEmIiO4t7fU09SLiosdGx25t7iMioseGhwnIyTJycqBcGOglY7DwsKMiosfGxwlISKzsbLv8PCsmYvCiFe9h1ujlYr///+DgYEfGxwiHh9XVFTZ2dn+/v76+vvq7O7Cu6eejVy7uro6NzgiHh8jHyAhHR5EQEG/vb78/Px2XBUsKCUjHyAkICEpJSYdGRpAPD3f398kICEjHyAlISKDgIGRj4+UkpPt7e1qYEdOS0shHR4kHyEkICEhHR5gXV7f3t7y8O/19fX29vjKwam7tak9OjsiHh8lISEkHyAkICE+OjpeVE5YUlFVUlNVU1NVUE83MjIjHx8jICErJCFrQR9ELR4gGxsdGRseGhseGhxGLx5sQSBUNyErJSdeOyFoQCFGLyIFEyI/LCFpQCFgPCFiPiIjHyAiHh+ysbHm5uarqqqRj5BZVlcgHR+0s7S8u7tJRke5uLh9e3tsPxtpPhzHyMl7eXr////8/PzGwbPd3Nf9/f2qkk6QcBb09fe/qWrHlAakegX+/v79/v/SyrPMnBa3ig04Lh0hHh/x8fHAo1TKlwhzWRbz7+z07+qyjja/qXRhVU5aTUVaUEx8SB5/Sh+kvHkiAAAApXRSTlMAAAAAAAAAAAAAAAAAAAAAADWs7/7spC4yz8UoCaL78/n78vqSA9/89/jr9Pz79eL1zRsz7ff++dz+/vDW2yfu/vvU/v3H1+7y1/v9xdfu+/Tt8vT7+cTY7vDz/v36+/zT3t3u/vLw/vns3e78/fX4+jDq8ff7/PjO1SQWv/P2+PLy+d7crQ1H1ff+9Onp9fXMOD7l2X5wcITd7EMMe5Q7AkSWew2abqMxAAAAAWJLR0RVkwS4MwAAAAd0SU1FB+cKAg8rCSPcU0AAAAEUSURBVBjTY2BgFBQSXgoCIqJi4kzMDAwSksuWLQMJAEkpaRYGGdllcvIKQJFlikrKy1RUGaTV1DU0tbSXLdPR1dM3MDRiMDYxNVtubmG5zGrFSmsbWzsGY3uHVasdnZzXrF233sXVDSjgvmHDRg/PTZu9tmz19vEFCvj5b9seEBgUHLJjZ2hYOFAgIjIqeldMbNzuPfEJiUlAgeSU1LT0XXv37T+QkbksCyiQnZObl3/w0OEjR48dLwAKFBYVl5SWHdx14uSp0+UVlVUM1TW1dWfO1jc0Np0739zS2sbA2t7R2XWhu6e37+Kl/gkT2RjYOSZNvjxl6rTpM2ZemTWbk4uBm2fO3Hnzefn4FyxctHiJADcAQx5tLT0vWccAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjMtMTAtMDJUMTU6NDM6MDkrMDA6MDCZdQqgAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIzLTEwLTAyVDE1OjQzOjA5KzAwOjAw6CiyHAAAAABJRU5ErkJggg==",L=B;Y({id:B,name:Z,favicon:rt,version:tt,description:et,author:nt,homepage:at,isNSFW:!1,language:"vi",updatedAt:1696841018699});function H(t){t=t.replace(/\.html$/i,"");const e=t.indexOf("/truyen-tranh/")+14;if(e===13)throw new Error("Invalid url "+t);t=t.slice(e,t.indexOf("?",e)>>>0).replace(/\.html$/,"");const n=t.match(/(.+?)-chap-(\d+)$/)||t.match(/(.+)$/);if(n){const[,a,o]=n;return o?{name:"comic chap",params:{sourceId:L,comic:a,chap:o}}:{name:"comic",params:{sourceId:L,comic:a}}}throw new Error("Invalid url "+t)}function O(t,e,n){var h;const a=H(e.find("a").attr("href")),o=e.find("img").attr("src"),s=e.find(".book_name").text().trim(),r=e.find(".more-info .info"),c=d(e.find(".last_chapter > a"),u=>R(u).replace("Đọc Tiếp","").trim()),i=H(c.path),y=[{route:i,name:c.name,id:(h=i.params.chap)!=null?h:i.params.comic,updated_at:q(e.find(".time-ago").text().trim(),n),views:null}],k=e.find(".type-label").text().trim(),x=r.length===0?null:r.eq(0).text().replace("Tình trạng:","").trim(),v=r.length===0?null:T(r.eq(2).text().trim().replace("Lượt theo dõi:","").replace(/,/g,"")),w=e.find(".list-tags").find("p").toArray().map(u=>t(u).text()),p=e.find(".excerpt").text().trim(),l=r.length===0?null:T(r.eq(1).text().trim().replace("Lượt xem:","").trim().replace(/,/g,""));return{route:a,image:o,name:s,othername:null,author:null,last_chapters:y,label:k,status:x,views:l,likes:v,comments:null,tags:w,description:p}}function ot(t,e){const n=parseDom(t),a=n(".hero .is-child").toArray().map(r=>{var p;const c=n(r),i=H(c.find("a").attr("href")),y=c.find("img").attr("src").replace("290x191","583x386"),k=c.find("h3").text(),x=c.find("h5").text().replace("Thể loại: ","").split(",").map(l=>l.trim())||[],v=c.find(".excerpt").text(),w=[{route:i,name:R(c.find(".chapter").text()),id:(p=i.params.chap)!=null?p:i.params.comic,updated_at:null,views:null}];return{route:{name:"comic",params:{sourceId:i.params.sourceId,comic:i.params.comic}},last_chapters:w,image:y,name:k,othername:"",status:"",author:"",views:null,comments:null,likes:null,label:null,tags:x,description:v}}),o=n("#div_suggest li").toArray().map(r=>O(n,n(r),e)),s=n("#main_homepage li").toArray().map(r=>O(n,n(r),e));return{sliders:a,hot:o,last_update:s}}function G(t){t=t.replace(/\.html$/i,"");const e=t.indexOf("/the-loai/")+10,n=t.slice(e,t.indexOf("?",e)>>>0).replace(/\/$/,"").replace(/\/$/,"_");return{name:"genre",params:{sourceId:L,type:n},query:Object.fromEntries(new URL(t,"http://localhost").searchParams.entries())}}function M(t,e){var x,v,w;const n=parseDom(t),a=n(".homepage_tags h1").text().trim(),o=n(".tags_detail").text().trim(),s=n(".story-list-bl01 tr").toArray().map(p=>{const l=n(p),h=l.find("th").text(),u=l.find("select option").toArray().map(m=>{const A=n(m),C=G(A.attr("value")),E=A.text();return{route:C,name:E}});if(h==="Sắp xếp"){let m="";const A=u.map(C=>{const[E,f]=Object.entries(C.route.query).at(-1);m=E;const I=C.name;return{value:f,name:I}});return{type:h,key:m,items:A}}if(u.length===0){let m="";const A=l.find(".choose a").toArray().map(C=>{const E=n(C),[f,I]=[...new URL(E.attr("href"),"http://localhost").searchParams.entries()].at(-1);m=f;const $=E.text();return{value:I,name:$}});return{type:h,key:m,items:A}}return{type:h,select:u}}),r=n("#main_homepage .list_grid li").toArray().map(p=>O(n,n(p),e)),c=parseInt(n(".page_redirect .active").text()),i=Number.isNaN(c)?1:c,y=parseInt((w=(v=(x=n(".page_redirect > *").last().attr("href"))==null?void 0:x.match(/\/trang-(\d+)/))==null?void 0:v[1])!=null?w:i+""),k=Number.isNaN(y)?1:y;return{name:a,description:o,filters:s,items:r,curPage:i,maxPage:k}}async function F(t,e,n){const{data:a,url:o}=await get({url:`${g}/${t.replace(".html","")}/trang-${e}.html?${new URLSearchParams(n)}`});if(P(o))throw new Error("not_found");return M(a,Date.now())}async function st(){const[t,e]=await Promise.all([get({url:g}).then(n=>ot(n.data,Date.now())),F("top-ngay",1,{})]);return{sliders:e.items.slice(0,7),hot:e.items.slice(7),last_update:t.last_update}}async function ct(t,e,n){const a=new URL(t,"http://localhost");a.searchParams.delete("page");for(const s in n){const r=n[s];Array.isArray(r)?r.forEach(c=>{a.searchParams.append(s,c)}):a.searchParams.set(s,n[s]+"")}const{data:o}=await get({url:`${g}/${a.pathname}/trang-${e}.html?${a.searchParams+""}`});return M(o,Date.now())}function N(t,e){const n=+t.find(".reply-comment").attr("onclick").match(/addReply\((\d+)\)/)[1]+"",a={avatar:t.find(".avartar-comment img").attr("data-src"),name:t.find(".outline-content-comment strong").text(),level:null,chapter:""},o=t.find(".content-comment").html().trim(),s=parseInt(t.find(".total-like-comment").text()),r=q(t.find(".time").text(),e),c=t.find(".text-list-reply").length===0?0:parseInt(t.find(".text-list-reply").text().trim());return{id:n,author:a,content:o,like:s,dislike:0,created_at:r,replies:c,chapter_name:""}}function it(t,e){var r,c;const n=parseDom(t),a=n(".info-comment").toArray().map(i=>N(n(i),e)),o=parseInt(n(".comment-count").text()),s=parseInt(((c=(r=n("#comment_list .page_redirect > p").last().attr("onclick"))==null?void 0:r.match(/(\d+)/))==null?void 0:c[1])||"0");return{comments:a,comments_count:o,comments_pages:s}}async function mt(t,e=0,n=1,a,o){const{data:s}=await post({url:`${g}/frontend/comment/list`,data:{book_id:t,parent_id:e,page:n,episode_id:a,team_id:o}});return it(s,Date.now())}function W(t){const e=parseDom(t);return e("a").toArray().map(n=>{const a=e(n),o=a.find(".time-chap"),{name:s,path:r}=d(a.find("a"),R),c=H(r);return{route:c,id:c.params.chap,name:s,updated_at:Q(o.text()),views:null}})}async function ut(t){const{data:e}=await post({url:`${g}/frontend/manga/list`,data:{id:t,order:1}});return await W(e)}function pt(t){const e=parseDom(t);return e("li > a").toArray().map(n=>{const a=e(n),o=H(a.attr("href")),s=a.find("img").attr("src"),r=a.find(".name").text(),c=a.find(".name_other").text(),i=R(a.find(".search_info p:eq(2)").text());return{route:o,image:s,name:r,othername:c,last_chapter:i,tags:[]}})}async function lt(t){const{data:e}=await post({url:`${g}/frontend/search/search`,data:{type:"0",search:t}});return pt(e)}async function ht(t,e){const{data:n}=await get({url:`${g}/tim-kiem/trang-${e}.html?q=${encodeURIComponent(t)}`});return M(n,Date.now())}function dt(t){t=t.replace(/\.html$/i,"");const e=t.indexOf("/tac-gia/")+9,n=t.slice(e,t.indexOf("?",e)>>>0).replace(/\/$/,"").replace(/\/$/,"_");return{name:"author",params:{sourceId:L,type:n},query:Object.fromEntries(new URL(t,"http://localhost").searchParams.entries())}}function gt(t,e){var C,E;const n=parseDom(t),a=n(".book_other h1").text().trim(),o=n(".other-name").text(),s=parseInt(n("#book_id").attr("value"))+"",r=q(n(".time-chap").eq(0).text().trim(),e),c=n(".book_avatar img").attr("src"),i=n(".author a").toArray().map(f=>{const{name:I,path:$}=d(n(f));return{name:I,route:dt($)}}),y=n(".status p:not(.name)").text().trim(),k=n(".list01 a").toArray().map(f=>{const{name:I,path:$}=d(n(f));return{name:I,route:G($)}}),x=T(n(".status").next().next().next().find("p:not(.name)").text().replace(/,/g,"")),v={cur:0,max:0,count:0},w=parseInt(n(".status").next().next().find("p:not(.name)").text().replace(/,/g,"")),p=parseInt(n(".status").next().find("p:not(.name)").text().replace(/,/g,"")),l=n(".detail-content").text().trim(),h=n(".works-chapter-item").toArray().map(f=>{const I=n(f),$=I.find(".time-chap"),{name:vt,path:wt}=d(I.find("a"),R),J=H(wt);return{route:J,id:J.params.chap,name:vt,updated_at:Q($.text()),views:null}}),u=n(".info-comment").toArray().map(f=>N(n(f),e)),m=parseInt(n(".comment-count").text()),A=parseInt(((E=(C=n("#comment_list .page_redirect > p").last().attr("onclick"))==null?void 0:C.match(/(\d+)/))==null?void 0:E[1])||"0");return{name:a,othername:o,manga_id:s,updated_at:r,image:c,author:i,status:y,genres:k,views:x,rate:v,follows:w,likes:p,description:l,chapters:h,comments:u,comments_count:m,comments_pages:A}}async function At(t){const{data:e,url:n}=await get({url:`${g}/truyen-tranh/${t}.html`});if(P(n))throw new Error("not_found");return gt(e,Date.now())}function ft(t,e,n=!1){var l,h;const a=parseDom(t),o=a("h1 > a").text(),s=parseInt(a("#book_id").attr("value"))+"",r=parseInt(a("#episode_name").attr("value"))+"",c=new Date(a(".detail-title").next("time").attr("datetime")).getTime(),i=a('meta[property="og:image"]').attr("content"),y=H(a("#path > ol > li:nth-child(2) > a").attr("href")),k=a(".page-chapter img").toArray().map(u=>{const m=a(u);return{src:m.attr("src"),original:m.attr("data-original"),cdn:m.attr("data-cdn")}}),x=a(".info-comment").toArray().map(u=>N(a(u),e)),v=parseInt(a(".comment-count").text()),w=parseInt(((h=(l=a("#comment_list .page_redirect > p").last().attr("onclick"))==null?void 0:l.match(/(\d+)/))==null?void 0:h[1])||"0"),p=a(".chapter_list option").toArray().map(u=>{const m=a(u),A=H(m.attr("value"));return{route:A,id:A.params.chap,name:R(m.text().trim()),updated_at:null,views:null}});return{name:o,manga_id:s,ep_id:r,updated_at:c,image:i,path_manga:y,pages:k,comments:x,comments_count:v,comments_pages:w,chapters:n?void 0:p}}async function yt(t,e,n){const{data:a,url:o}=await get({url:`${g}/truyen-tranh/${t}-chap-${e}.html`});if(P(o))throw new Error("not_found");const s=await ft(a,Date.now(),n);if(!n&&!s.chapters){const{data:r}=await post({url:`${g}/frontend/manga/list`,data:{id:s.manga_id,order:1}});s.chapters=await W(r)}return s}class xt{constructor(e,n){S(this,"Rankings",z);S(this,"Servers",K);S(this,"get");S(this,"post");this.get=e,this.post=n}async index(){return st()}async getComic(e){return At(e)}async getComicChapter(e,n,a){return yt(e,n,a)}async getComicComments(e,n,a=-1,o=0,s,r){return mt(e,o,s,a,r)}async getListChapters(e){return ut(e)}async searchQuickly(e,n){return lt(e)}async search(e,n){return ht(e,n)}async getRanking(e,n,a){e=e.toLowerCase();const o=z.find(s=>s.value.toLowerCase()===e);if(!o)throw new Error("not_found");return F(o.match,n,a)}async getCategory(e,n,a){return ct(e,n,a)}}X(xt)})();
